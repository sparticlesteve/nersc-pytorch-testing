3: Distributed init with master addr 10.100.0.24 port 29500
1: Distributed init with master addr 10.100.0.24 port 29500
2: Distributed init with master addr 10.100.0.24 port 29500
0: Distributed init with master addr 10.100.0.24 port 29500
6: Distributed init with master addr 10.100.0.24 port 29500
7: Distributed init with master addr 10.100.0.24 port 29500
4: Distributed init with master addr 10.100.0.24 port 29500
5: Distributed init with master addr 10.100.0.24 port 29500
0: Initialized host nid001028 rank 0 local-rank 0 size 8
2: Initialized host nid001028 rank 2 local-rank 2 size 8
4: Initialized host nid001029 rank 4 local-rank 0 size 8
6: Initialized host nid001029 rank 6 local-rank 2 size 8
7: Initialized host nid001029 rank 7 local-rank 3 size 8
1: Initialized host nid001028 rank 1 local-rank 1 size 8
5: Initialized host nid001029 rank 5 local-rank 1 size 8
3: Initialized host nid001028 rank 3 local-rank 3 size 8
0: cuda:0
0: Generating a batch of data
2: cuda:2
2: Generating a batch of data
1: cuda:1
1: Generating a batch of data
6: cuda:2
6: Generating a batch of data
7: cuda:3
7: Generating a batch of data
3: cuda:3
3: Generating a batch of data
4: cuda:0
4: Generating a batch of data
5: cuda:1
5: Generating a batch of data
1: Constructing model
2: Constructing model
5: Constructing model
6: Constructing model
7: Constructing model
0: Constructing model
3: Constructing model
4: Constructing model
0: nid001028:129733:129733 [0] NCCL INFO Bootstrap : Using nmn0:10.100.0.24<0>
0: nid001028:129733:129733 [0] NCCL INFO Plugin Path : /opt/hpcx/nccl_rdma_sharp_plugin/lib/libnccl-net.so
0: nid001028:129733:129733 [0] NCCL INFO P2P plugin IBext
0: nid001028:129733:129733 [0] NCCL INFO NET/IB : Using [0]mlx5_0:1/RoCE [1]mlx5_1:1/RoCE ; OOB nmn0:10.100.0.24<0>
0: nid001028:129733:129733 [0] NCCL INFO Using network IBext
0: NCCL version 2.9.8+cuda11.3
3: nid001028:129736:129736 [3] NCCL INFO Bootstrap : Using nmn0:10.100.0.24<0>
2: nid001028:129735:129735 [2] NCCL INFO Bootstrap : Using nmn0:10.100.0.24<0>
1: nid001028:129734:129734 [1] NCCL INFO Bootstrap : Using nmn0:10.100.0.24<0>
3: nid001028:129736:129736 [3] NCCL INFO Plugin Path : /opt/hpcx/nccl_rdma_sharp_plugin/lib/libnccl-net.so
3: nid001028:129736:129736 [3] NCCL INFO P2P plugin IBext
1: nid001028:129734:129734 [1] NCCL INFO Plugin Path : /opt/hpcx/nccl_rdma_sharp_plugin/lib/libnccl-net.so
1: nid001028:129734:129734 [1] NCCL INFO P2P plugin IBext
2: nid001028:129735:129735 [2] NCCL INFO Plugin Path : /opt/hpcx/nccl_rdma_sharp_plugin/lib/libnccl-net.so
2: nid001028:129735:129735 [2] NCCL INFO P2P plugin IBext
3: nid001028:129736:129736 [3] NCCL INFO NET/IB : Using [0]mlx5_0:1/RoCE [1]mlx5_1:1/RoCE ; OOB nmn0:10.100.0.24<0>
3: nid001028:129736:129736 [3] NCCL INFO Using network IBext
6: nid001029:130948:130948 [2] NCCL INFO Bootstrap : Using nmn0:10.100.0.29<0>
5: nid001029:130947:130947 [1] NCCL INFO Bootstrap : Using nmn0:10.100.0.29<0>
4: nid001029:130946:130946 [0] NCCL INFO Bootstrap : Using nmn0:10.100.0.29<0>
7: nid001029:130949:130949 [3] NCCL INFO Bootstrap : Using nmn0:10.100.0.29<0>
1: nid001028:129734:129734 [1] NCCL INFO NET/IB : Using [0]mlx5_0:1/RoCE [1]mlx5_1:1/RoCE ; OOB nmn0:10.100.0.24<0>
1: nid001028:129734:129734 [1] NCCL INFO Using network IBext
2: nid001028:129735:129735 [2] NCCL INFO NET/IB : Using [0]mlx5_0:1/RoCE [1]mlx5_1:1/RoCE ; OOB nmn0:10.100.0.24<0>
2: nid001028:129735:129735 [2] NCCL INFO Using network IBext
4: nid001029:130946:130946 [0] NCCL INFO Plugin Path : /opt/hpcx/nccl_rdma_sharp_plugin/lib/libnccl-net.so
4: nid001029:130946:130946 [0] NCCL INFO P2P plugin IBext
6: nid001029:130948:130948 [2] NCCL INFO Plugin Path : /opt/hpcx/nccl_rdma_sharp_plugin/lib/libnccl-net.so
6: nid001029:130948:130948 [2] NCCL INFO P2P plugin IBext
7: nid001029:130949:130949 [3] NCCL INFO Plugin Path : /opt/hpcx/nccl_rdma_sharp_plugin/lib/libnccl-net.so
7: nid001029:130949:130949 [3] NCCL INFO P2P plugin IBext
5: nid001029:130947:130947 [1] NCCL INFO Plugin Path : /opt/hpcx/nccl_rdma_sharp_plugin/lib/libnccl-net.so
5: nid001029:130947:130947 [1] NCCL INFO P2P plugin IBext
4: nid001029:130946:130946 [0] NCCL INFO NET/IB : Using [0]mlx5_0:1/RoCE [1]mlx5_1:1/RoCE ; OOB nmn0:10.100.0.29<0>
4: nid001029:130946:130946 [0] NCCL INFO Using network IBext
5: nid001029:130947:130947 [1] NCCL INFO NET/IB : Using [0]mlx5_0:1/RoCE [1]mlx5_1:1/RoCE ; OOB nmn0:10.100.0.29<0>
5: nid001029:130947:130947 [1] NCCL INFO Using network IBext
7: nid001029:130949:130949 [3] NCCL INFO NET/IB : Using [0]mlx5_0:1/RoCE [1]mlx5_1:1/RoCE ; OOB nmn0:10.100.0.29<0>
7: nid001029:130949:130949 [3] NCCL INFO Using network IBext
6: nid001029:130948:130948 [2] NCCL INFO NET/IB : Using [0]mlx5_0:1/RoCE [1]mlx5_1:1/RoCE ; OOB nmn0:10.100.0.29<0>
6: nid001029:130948:130948 [2] NCCL INFO Using network IBext
2: nid001028:129735:1740 [2] NCCL INFO Trees [0] 3/-1/-1->2->1 [1] -1/-1/-1->2->1 [2] 3/-1/-1->2->1 [3] -1/-1/-1->2->1
2: nid001028:129735:1740 [2] NCCL INFO Setting affinity for GPU 2 to ffff0000,00000000,ffff0000
3: nid001028:129736:1734 [3] NCCL INFO Trees [0] -1/-1/-1->3->2 [1] 0/7/-1->3->-1 [2] -1/-1/-1->3->2 [3] 0/-1/-1->3->7
3: nid001028:129736:1734 [3] NCCL INFO Setting affinity for GPU 3 to ffff,00000000,0000ffff
6: nid001029:130948:3052 [2] NCCL INFO Trees [0] 7/-1/-1->6->5 [1] -1/-1/-1->6->5 [2] 7/-1/-1->6->5 [3] -1/-1/-1->6->5
6: nid001029:130948:3052 [2] NCCL INFO Setting affinity for GPU 2 to ffff0000,00000000,ffff0000
7: nid001029:130949:3051 [3] NCCL INFO Trees [0] -1/-1/-1->7->6 [1] 4/-1/-1->7->3 [2] -1/-1/-1->7->6 [3] 4/3/-1->7->-1
7: nid001029:130949:3051 [3] NCCL INFO Setting affinity for GPU 3 to ffff,00000000,0000ffff
0: nid001028:129733:1730 [0] NCCL INFO Channel 00/04 :    0   1   2   3   4   5   6   7
0: nid001028:129733:1730 [0] NCCL INFO Channel 01/04 :    0   1   2   3   4   5   6   7
0: nid001028:129733:1730 [0] NCCL INFO Channel 02/04 :    0   1   2   3   4   5   6   7
0: nid001028:129733:1730 [0] NCCL INFO Channel 03/04 :    0   1   2   3   4   5   6   7
0: nid001028:129733:1730 [0] NCCL INFO Trees [0] 1/4/-1->0->-1 [1] 1/-1/-1->0->3 [2] 1/-1/-1->0->4 [3] 1/-1/-1->0->3
0: nid001028:129733:1730 [0] NCCL INFO Setting affinity for GPU 0 to ffff0000,00000000,ffff0000,00000000
1: nid001028:129734:1739 [1] NCCL INFO Trees [0] 2/-1/-1->1->0 [1] 2/-1/-1->1->0 [2] 2/-1/-1->1->0 [3] 2/-1/-1->1->0
1: nid001028:129734:1739 [1] NCCL INFO Setting affinity for GPU 1 to ffff,00000000,0000ffff,00000000
4: nid001029:130946:3046 [0] NCCL INFO Trees [0] 5/-1/-1->4->0 [1] 5/-1/-1->4->7 [2] 5/0/-1->4->-1 [3] 5/-1/-1->4->7
4: nid001029:130946:3046 [0] NCCL INFO Setting affinity for GPU 0 to ffff0000,00000000,ffff0000,00000000
5: nid001029:130947:3050 [1] NCCL INFO Trees [0] 6/-1/-1->5->4 [1] 6/-1/-1->5->4 [2] 6/-1/-1->5->4 [3] 6/-1/-1->5->4
5: nid001029:130947:3050 [1] NCCL INFO Setting affinity for GPU 1 to ffff,00000000,0000ffff,00000000
0: nid001028:129733:1730 [0] NCCL INFO Channel 00 : 7[c1000] -> 0[2000] [receive] via NET/IBext/1
4: nid001029:130946:3046 [0] NCCL INFO Channel 00 : 3[c1000] -> 4[2000] [receive] via NET/IBext/1
2: nid001028:129735:1740 [2] NCCL INFO Channel 00 : 2[81000] -> 3[c1000] via P2P/IPC/read
6: nid001029:130948:3052 [2] NCCL INFO Channel 00 : 6[81000] -> 7[c1000] via P2P/IPC/read
2: nid001028:129735:1740 [2] NCCL INFO Channel 01 : 2[81000] -> 3[c1000] via P2P/IPC/read
6: nid001029:130948:3052 [2] NCCL INFO Channel 01 : 6[81000] -> 7[c1000] via P2P/IPC/read
5: nid001029:130947:3050 [1] NCCL INFO Channel 00 : 5[41000] -> 6[81000] via P2P/IPC/read
6: nid001029:130948:3052 [2] NCCL INFO Channel 02 : 6[81000] -> 7[c1000] via P2P/IPC/read
2: nid001028:129735:1740 [2] NCCL INFO Channel 02 : 2[81000] -> 3[c1000] via P2P/IPC/read
5: nid001029:130947:3050 [1] NCCL INFO Channel 01 : 5[41000] -> 6[81000] via P2P/IPC/read
3: nid001028:129736:1734 [3] NCCL INFO Channel 00 : 3[c1000] -> 4[2000] [send] via NET/IBext/1
2: nid001028:129735:1740 [2] NCCL INFO Channel 03 : 2[81000] -> 3[c1000] via P2P/IPC/read
0: nid001028:129733:1730 [0] NCCL INFO Channel 01 : 7[c1000] -> 0[2000] [receive] via NET/IBext/0
6: nid001029:130948:3052 [2] NCCL INFO Channel 03 : 6[81000] -> 7[c1000] via P2P/IPC/read
5: nid001029:130947:3050 [1] NCCL INFO Channel 02 : 5[41000] -> 6[81000] via P2P/IPC/read
1: nid001028:129734:1739 [1] NCCL INFO Channel 00 : 1[41000] -> 2[81000] via P2P/IPC/read
4: nid001029:130946:3046 [0] NCCL INFO Channel 01 : 3[c1000] -> 4[2000] [receive] via NET/IBext/0
1: nid001028:129734:1739 [1] NCCL INFO Channel 01 : 1[41000] -> 2[81000] via P2P/IPC/read
5: nid001029:130947:3050 [1] NCCL INFO Channel 03 : 5[41000] -> 6[81000] via P2P/IPC/read
7: nid001029:130949:3051 [3] NCCL INFO Channel 00 : 7[c1000] -> 0[2000] [send] via NET/IBext/1
1: nid001028:129734:1739 [1] NCCL INFO Channel 02 : 1[41000] -> 2[81000] via P2P/IPC/read
1: nid001028:129734:1739 [1] NCCL INFO Channel 03 : 1[41000] -> 2[81000] via P2P/IPC/read
3: nid001028:129736:1734 [3] NCCL INFO Channel 01 : 3[c1000] -> 4[2000] [send] via NET/IBext/0
0: nid001028:129733:1730 [0] NCCL INFO Channel 02 : 7[c1000] -> 0[2000] [receive] via NET/IBext/1
4: nid001029:130946:3046 [0] NCCL INFO Channel 02 : 3[c1000] -> 4[2000] [receive] via NET/IBext/1
7: nid001029:130949:3051 [3] NCCL INFO Channel 01 : 7[c1000] -> 0[2000] [send] via NET/IBext/0
3: nid001028:129736:1734 [3] NCCL INFO Channel 02 : 3[c1000] -> 4[2000] [send] via NET/IBext/1
0: nid001028:129733:1730 [0] NCCL INFO Channel 03 : 7[c1000] -> 0[2000] [receive] via NET/IBext/0
0: nid001028:129733:1730 [0] NCCL INFO Channel 00 : 0[2000] -> 1[41000] via P2P/IPC/read
4: nid001029:130946:3046 [0] NCCL INFO Channel 03 : 3[c1000] -> 4[2000] [receive] via NET/IBext/0
0: nid001028:129733:1730 [0] NCCL INFO Channel 01 : 0[2000] -> 1[41000] via P2P/IPC/read
7: nid001029:130949:3051 [3] NCCL INFO Channel 02 : 7[c1000] -> 0[2000] [send] via NET/IBext/1
4: nid001029:130946:3046 [0] NCCL INFO Channel 00 : 4[2000] -> 5[41000] via P2P/IPC/read
0: nid001028:129733:1730 [0] NCCL INFO Channel 02 : 0[2000] -> 1[41000] via P2P/IPC/read
4: nid001029:130946:3046 [0] NCCL INFO Channel 01 : 4[2000] -> 5[41000] via P2P/IPC/read
0: nid001028:129733:1730 [0] NCCL INFO Channel 03 : 0[2000] -> 1[41000] via P2P/IPC/read
4: nid001029:130946:3046 [0] NCCL INFO Channel 02 : 4[2000] -> 5[41000] via P2P/IPC/read
3: nid001028:129736:1734 [3] NCCL INFO Channel 03 : 3[c1000] -> 4[2000] [send] via NET/IBext/0
4: nid001029:130946:3046 [0] NCCL INFO Channel 03 : 4[2000] -> 5[41000] via P2P/IPC/read
3: 
3: nid001028:129736:1734 [3] ibvwrap.c:118 NCCL WARN Call to ibv_create_cq failed
3: nid001028:129736:1734 [3] NCCL INFO ib_plugin.c:174 -> 2
3: nid001028:129736:1734 [3] NCCL INFO ib_plugin.c:271 -> 2
3: nid001028:129736:1734 [3] NCCL INFO include/net.h:21 -> 2
3: nid001028:129736:1734 [3] NCCL INFO transport/net.cc:210 -> 2
3: nid001028:129736:1734 [3] NCCL INFO transport.cc:111 -> 2
3: nid001028:129736:1734 [3] NCCL INFO init.cc:729 -> 2
3: nid001028:129736:1734 [3] NCCL INFO init.cc:817 -> 2
3: nid001028:129736:1734 [3] NCCL INFO group.cc:72 -> 2 [Async thread]
7: nid001029:130949:3051 [3] NCCL INFO Channel 03 : 7[c1000] -> 0[2000] [send] via NET/IBext/0
7: 
7: nid001029:130949:3051 [3] ibvwrap.c:118 NCCL WARN Call to ibv_create_cq failed
7: nid001029:130949:3051 [3] NCCL INFO ib_plugin.c:174 -> 2
7: nid001029:130949:3051 [3] NCCL INFO ib_plugin.c:271 -> 2
7: nid001029:130949:3051 [3] NCCL INFO include/net.h:21 -> 2
7: nid001029:130949:3051 [3] NCCL INFO transport/net.cc:210 -> 2
7: nid001029:130949:3051 [3] NCCL INFO transport.cc:111 -> 2
7: nid001029:130949:3051 [3] NCCL INFO init.cc:729 -> 2
7: nid001029:130949:3051 [3] NCCL INFO init.cc:817 -> 2
7: nid001029:130949:3051 [3] NCCL INFO group.cc:72 -> 2 [Async thread]
1: nid001028:129734:1739 [1] NCCL INFO Connected all rings
5: nid001029:130947:3050 [1] NCCL INFO Connected all rings
2: nid001028:129735:1740 [2] NCCL INFO Connected all rings
6: nid001029:130948:3052 [2] NCCL INFO Connected all rings
2: nid001028:129735:1740 [2] NCCL INFO Channel 00 : 2[81000] -> 1[41000] via P2P/IPC/read
2: nid001028:129735:1740 [2] NCCL INFO Channel 01 : 2[81000] -> 1[41000] via P2P/IPC/read
1: nid001028:129734:1739 [1] NCCL INFO Channel 00 : 1[41000] -> 0[2000] via P2P/IPC/read
2: nid001028:129735:1740 [2] NCCL INFO Channel 02 : 2[81000] -> 1[41000] via P2P/IPC/read
6: nid001029:130948:3052 [2] NCCL INFO Channel 00 : 6[81000] -> 5[41000] via P2P/IPC/read
1: nid001028:129734:1739 [1] NCCL INFO Channel 01 : 1[41000] -> 0[2000] via P2P/IPC/read
5: nid001029:130947:3050 [1] NCCL INFO Channel 00 : 5[41000] -> 4[2000] via P2P/IPC/read
2: nid001028:129735:1740 [2] NCCL INFO Channel 03 : 2[81000] -> 1[41000] via P2P/IPC/read
6: nid001029:130948:3052 [2] NCCL INFO Channel 01 : 6[81000] -> 5[41000] via P2P/IPC/read
1: nid001028:129734:1739 [1] NCCL INFO Channel 02 : 1[41000] -> 0[2000] via P2P/IPC/read
5: nid001029:130947:3050 [1] NCCL INFO Channel 01 : 5[41000] -> 4[2000] via P2P/IPC/read
1: nid001028:129734:1739 [1] NCCL INFO Channel 03 : 1[41000] -> 0[2000] via P2P/IPC/read
6: nid001029:130948:3052 [2] NCCL INFO Channel 02 : 6[81000] -> 5[41000] via P2P/IPC/read
5: nid001029:130947:3050 [1] NCCL INFO Channel 02 : 5[41000] -> 4[2000] via P2P/IPC/read
6: nid001029:130948:3052 [2] NCCL INFO Channel 03 : 6[81000] -> 5[41000] via P2P/IPC/read
5: nid001029:130947:3050 [1] NCCL INFO Channel 03 : 5[41000] -> 4[2000] via P2P/IPC/read
3: Traceback (most recent call last):
3:   File "test_ddp.py", line 95, in <module>
3:     main()
3:   File "test_ddp.py", line 71, in main
3:     model = DistributedDataParallel(model, device_ids=device_ids)
3:   File "/opt/conda/lib/python3.8/site-packages/torch/nn/parallel/distributed.py", line 467, in __init__
3:     dist._verify_model_across_ranks(self.process_group, parameters)
3: RuntimeError: NCCL error in: ../torch/lib/c10d/ProcessGroupNCCL.cpp:832, unhandled system error, NCCL version 20.9.8
3: ncclSystemError: System call (socket, malloc, munmap, etc) failed.
7: Traceback (most recent call last):
7:   File "test_ddp.py", line 95, in <module>
7:     main()
7:   File "test_ddp.py", line 71, in main
7:     model = DistributedDataParallel(model, device_ids=device_ids)
7:   File "/opt/conda/lib/python3.8/site-packages/torch/nn/parallel/distributed.py", line 467, in __init__
7:     dist._verify_model_across_ranks(self.process_group, parameters)
7: RuntimeError: NCCL error in: ../torch/lib/c10d/ProcessGroupNCCL.cpp:832, unhandled system error, NCCL version 20.9.8
7: ncclSystemError: System call (socket, malloc, munmap, etc) failed.
0: 
0: nid001028:129733:1730 [0] ../include/socket.h:420 NCCL WARN Net : Connection closed by remote peer
0: nid001028:129733:1730 [0] NCCL INFO ../include/socket.h:442 -> 2
0: nid001028:129733:1730 [0] NCCL INFO ../include/socket.h:454 -> 2
0: nid001028:129733:1730 [0] NCCL INFO ib_plugin.c:311 -> 2
0: nid001028:129733:1730 [0] NCCL INFO include/net.h:22 -> 2
0: nid001028:129733:1730 [0] NCCL INFO transport/net.cc:234 -> 2
0: nid001028:129733:1730 [0] NCCL INFO transport.cc:119 -> 2
0: nid001028:129733:1730 [0] NCCL INFO init.cc:729 -> 2
0: nid001028:129733:1730 [0] NCCL INFO init.cc:817 -> 2
0: nid001028:129733:1730 [0] NCCL INFO group.cc:72 -> 2 [Async thread]
4: 
4: nid001029:130946:3046 [0] ../include/socket.h:420 NCCL WARN Net : Connection closed by remote peer
4: nid001029:130946:3046 [0] NCCL INFO ../include/socket.h:442 -> 2
4: nid001029:130946:3046 [0] NCCL INFO ../include/socket.h:454 -> 2
4: nid001029:130946:3046 [0] NCCL INFO ib_plugin.c:311 -> 2
4: nid001029:130946:3046 [0] NCCL INFO include/net.h:22 -> 2
4: nid001029:130946:3046 [0] NCCL INFO transport/net.cc:234 -> 2
4: nid001029:130946:3046 [0] NCCL INFO transport.cc:119 -> 2
4: nid001029:130946:3046 [0] NCCL INFO init.cc:729 -> 2
4: nid001029:130946:3046 [0] NCCL INFO init.cc:817 -> 2
4: nid001029:130946:3046 [0] NCCL INFO group.cc:72 -> 2 [Async thread]
0: Traceback (most recent call last):
0:   File "test_ddp.py", line 95, in <module>
0:     main()
0:   File "test_ddp.py", line 71, in main
0:     model = DistributedDataParallel(model, device_ids=device_ids)
0:   File "/opt/conda/lib/python3.8/site-packages/torch/nn/parallel/distributed.py", line 467, in __init__
0:     dist._verify_model_across_ranks(self.process_group, parameters)
0: RuntimeError: NCCL error in: ../torch/lib/c10d/ProcessGroupNCCL.cpp:832, unhandled system error, NCCL version 20.9.8
0: ncclSystemError: System call (socket, malloc, munmap, etc) failed.
4: Traceback (most recent call last):
4:   File "test_ddp.py", line 95, in <module>
4:     main()
4:   File "test_ddp.py", line 71, in main
4:     model = DistributedDataParallel(model, device_ids=device_ids)
4:   File "/opt/conda/lib/python3.8/site-packages/torch/nn/parallel/distributed.py", line 467, in __init__
4:     dist._verify_model_across_ranks(self.process_group, parameters)
4: RuntimeError: NCCL error in: ../torch/lib/c10d/ProcessGroupNCCL.cpp:832, unhandled system error, NCCL version 20.9.8
4: ncclSystemError: System call (socket, malloc, munmap, etc) failed.
srun: error: nid001028: task 3: Exited with exit code 1
srun: launch/slurm: _step_signal: Terminating StepId=8597.0
0: slurmstepd: error: *** STEP 8597.0 ON nid001028 CANCELLED AT 2021-06-01T20:48:54 ***
srun: error: nid001029: task 7: Exited with exit code 1
srun: error: nid001029: task 4: Exited with exit code 1
srun: error: nid001029: task 6: Terminated
srun: error: nid001029: task 5: Terminated
srun: error: nid001028: tasks 0-2: Terminated
srun: Force Terminated StepId=8597.0
